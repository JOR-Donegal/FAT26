{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":"<p>File Allocation Table</p> <p>I could make you read all week on the topic of file systems and their underlying metadata. You would sleep well but learn nothing! By getting you to extract metadata structures, map and understand them, we can ensure a basic understanding. Before you start, you need to make sure you have understood my notes on file systems. If you approach this methodically, it will all work fine.</p> <p>You will be required to keep a list of commands with notes as to why you are using them as well as results of any testing you have done. You may be asked to present these notes as evidence of work completed or as part of a lab book. Check with your lecturer.</p> <p>Before you begin these exercises, take a look at this video from a live session in 2019.</p>"},{"location":"a/","title":"Windows","text":"<p>Create a virtual disk in Windows as previously demonstrated in practical sessions. You may use diskpart or the graphical disk tools.</p> <ul> <li>Initialize the disk as an MBR disk.</li> <li>Create a single primary partition.</li> <li>Format it as FAT32.</li> <li>Create a short text file of arbitrary length on the desktop, you will need it later.</li> <li>Copy across one large file c.1MB; a JPEG photograph, on the desktop, you will need it later.</li> </ul>"},{"location":"b/","title":"Interpreting the Structure","text":"<p>Using techniques from the previous practical on partition tables, I read the MBR partition table and located the first partition.</p> Fig 1. WinHex. <p>I extracted the first partition table entry.</p> Fig 2. Partition Table. <ul> <li>The partition is not bootable</li> <li>Partition type is 0x0C, FAT32 or 0x0E for FAT16</li> <li>LBA starts at 0x00000080 (4 bytes, little endian) and with 512-byte - Sectors, this gives a start of 0x80 * 51210 = 65,536</li> <li>LBA ends at 0x001F2800 (4 bytes, little endian) or sector 2,041,856</li> </ul> <p>Now I can locate the start of the FAT partition at sector 128, address 65,536.</p>"},{"location":"c/","title":"The first 36 bytes","text":"<p>I capture this data with WINHEX.</p> Fig 3. The FAT. <p>The first 36 bytes have the following format.</p> Fig 4. Interpret the FAT."},{"location":"d/","title":"EBPB","text":"<p>The Extended BIOS Parameter Block (EBPB) needs to be decoded next.</p> Fig 5. WinHex dump. <p>The Extended BIOS Parameter Block has the following format.</p> Fig 6. Interpret the EBPB."},{"location":"e/","title":"The Root Directory","text":"<p>To locate the root directory; - Each sector is 512 bytes - The file system starts at sector 128 - The reserved area is 4 sectors - There are 2 FATs - Each FAT is 250 sectors - The root directory should be 632 sectors in or at byte 323,584.</p> Fig 7. Interpret the EBPB. <p>I now navigate to the correct sector and verify that there appears to be an empty root directory, on a volume called RUBBISH (first 32 bytes). Byte 0x0B has a value 0x08, the table shows this to be a volume label.</p> Fig 8. Byte table. <p>In the next two groups of 32 bytes, byte 0x0B is set to 0x0F. This marks the entry as system/hidden/read only. The final group of 32 bytes has an attribute 0x16, this marks the entry as subdirectory/system/hidden.</p> Fig 9. The directory."},{"location":"f/","title":"Small File","text":"<p>I save a small file in the root of the directory and then re-examine.</p> Fig 10. The directory. <p>I extract the bytes relating to the new file entry, note there is also a Recycle Bin entry. File names were originally 8:3, but with Long File Names (LFNs) bytes:</p> Fig 11. The directory, decoded. <p>The first 32 bytes are the LFN entry.</p> Fig 12. LFN. <p>The next 32 bytes are the same format as the original directory before LFN.</p> Fig 13. Directory entry. <p>FAT1 is located at cluster 128 + 4 = 132 or byte 65,536 + 2,048 = 67,584. THE FAT is very simple, almost empty. Each entry is 16 bits, so cluster 0x05 is as shown, with a value of 0xFFFF. This makes sense, it\u2019s a file with less than 512 bytes, it occupies a single cluster.</p> Fig 14. Decoding. Fig 15. WinHex the sector."},{"location":"g/","title":"Larger File","text":"<p>Next, I saved a JPEG file to the partition, (Narrow MugShot-JOR.JPG). A quick look at the directory entry gives me a starting cluster of 0x08.</p> Fig 16. Directory Entry. <p>I can see a file that spans more than one cluster! In cluster 0x08 there is a pointer to the next cluster with parts of the file, 0x09. This continues in sequence for 12 cluster until cluster 19 has the EOF value, 0xFFFF.</p> Fig 17. FAT."}]}